# ğŸ“± å‰ç«¯å¼€å‘å®Œæ•´æŒ‡å—

åŸºäºå½“å‰å®Œå–„çš„ **FastAPI + JWT** åç«¯æ¶æ„ï¼Œä¸ºå‰ç«¯å¼€å‘è€…æä¾›è¯¦ç»†çš„å¼€å‘æŒ‡å—ã€‚

## ğŸ¯ åç«¯ API æ¦‚è§ˆ

### ğŸš€ æœåŠ¡åœ°å€
- **å¼€å‘ç¯å¢ƒ**: `http://localhost:8001`
- **APIæ–‡æ¡£**: `http://localhost:8001/docs` (Swagger UI)
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **å“åº”æ ¼å¼**: JSON

### ğŸ“‹ æ ¸å¿ƒ API ç«¯ç‚¹

#### ğŸ” è®¤è¯ç›¸å…³
```
POST /api/v1/auth/register    # ç”¨æˆ·æ³¨å†Œ
POST /api/v1/auth/login       # ç”¨æˆ·ç™»å½•  
POST /api/v1/auth/refresh     # Tokenåˆ·æ–°
```

#### ğŸ‘¤ ç”¨æˆ·ç®¡ç†
```
GET  /api/v1/users/me         # è·å–å½“å‰ç”¨æˆ·å®Œæ•´èµ„æ–™
PUT  /api/v1/users/me         # æ›´æ–°å½“å‰ç”¨æˆ·èµ„æ–™
GET  /api/v1/users/me/basic   # è·å–å½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
GET  /api/v1/users/{id}/profile # è·å–æŒ‡å®šç”¨æˆ·å…¬å¼€èµ„æ–™
```

#### ğŸ¥ ç³»ç»ŸçŠ¶æ€
```
GET  /health                  # å¥åº·æ£€æŸ¥
GET  /                        # æ ¹è·¯å¾„
```

## ğŸ—ï¸ æ¨èå‰ç«¯æ¶æ„ (Next.js 14+)

### ğŸ“ é¡¹ç›®ç»“æ„
```
/app
â”œâ”€â”€ (auth)/                   # è®¤è¯è·¯ç”±ç»„
â”‚   â”œâ”€â”€ layout.tsx           # è®¤è¯å¸ƒå±€ï¼ˆç®€æ´æ ·å¼ï¼‰
â”‚   â”œâ”€â”€ login/page.tsx       # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ register/page.tsx    # æ³¨å†Œé¡µé¢
â”œâ”€â”€ (dashboard)/             # ä¸»åº”ç”¨è·¯ç”±ç»„  
â”‚   â”œâ”€â”€ layout.tsx          # ä¸»å¸ƒå±€ï¼ˆå¯¼èˆªæ ã€ä¾§è¾¹æ ï¼‰
â”‚   â”œâ”€â”€ page.tsx            # ä»ªè¡¨ç›˜é¦–é¡µ
â”‚   â”œâ”€â”€ profile/page.tsx    # ä¸ªäººèµ„æ–™é¡µ
â”‚   â”œâ”€â”€ settings/page.tsx   # è®¾ç½®é¡µé¢
â”‚   â””â”€â”€ users/[id]/page.tsx # ç”¨æˆ·è¯¦æƒ…é¡µ
â”œâ”€â”€ components/              # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ auth/               # è®¤è¯ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚   â””â”€â”€ AuthGuard.tsx
â”‚   â”œâ”€â”€ layout/             # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Navbar.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ user/               # ç”¨æˆ·ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ UserProfile.tsx
â”‚   â”‚   â”œâ”€â”€ UserCard.tsx
â”‚   â”‚   â””â”€â”€ EditProfile.tsx
â”‚   â””â”€â”€ ui/                 # åŸºç¡€UIç»„ä»¶
â”‚       â”œâ”€â”€ Button.tsx
â”‚       â”œâ”€â”€ Input.tsx
â”‚       â””â”€â”€ LoadingSpinner.tsx
â”œâ”€â”€ lib/                    # å·¥å…·å‡½æ•°å’Œé…ç½®
â”‚   â”œâ”€â”€ api/               # APIç›¸å…³
â”‚   â”‚   â”œâ”€â”€ client.ts      # APIå®¢æˆ·ç«¯é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.ts        # è®¤è¯API
â”‚   â”‚   â””â”€â”€ users.ts       # ç”¨æˆ·API
â”‚   â”œâ”€â”€ auth/              # è®¤è¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ context.tsx    # è®¤è¯Context
â”‚   â”‚   â”œâ”€â”€ hooks.ts       # è®¤è¯Hooks
â”‚   â”‚   â””â”€â”€ types.ts       # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ storage.ts     # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â””â”€â”€ validators.ts  # è¡¨å•éªŒè¯
â”‚   â””â”€â”€ constants.ts       # å¸¸é‡é…ç½®
â”œâ”€â”€ types/                 # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ user.ts
â”‚   â””â”€â”€ api.ts
â””â”€â”€ middleware.ts          # Next.jsä¸­é—´ä»¶ï¼ˆè·¯ç”±ä¿æŠ¤ï¼‰
```

## ğŸ”‘ è®¤è¯ç³»ç»Ÿé›†æˆ

### 1. API å®¢æˆ·ç«¯é…ç½®

```typescript
// lib/api/client.ts
import axios from 'axios';

const API_BASE_URL = 'http://localhost:8001';

// åˆ›å»ºaxioså®ä¾‹
export const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// è¯·æ±‚æ‹¦æˆªå™¨ - è‡ªåŠ¨æ·»åŠ Token
apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// å“åº”æ‹¦æˆªå™¨ - å¤„ç†Tokenè¿‡æœŸ
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Tokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
      try {
        await refreshToken();
        // é‡è¯•åŸè¯·æ±‚
        return apiClient.request(error.config);
      } catch (refreshError) {
        // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
        localStorage.removeItem('access_token');
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);

// Tokenåˆ·æ–°å‡½æ•°
async function refreshToken() {
  const token = localStorage.getItem('access_token');
  if (!token) throw new Error('No token available');
  
  const response = await axios.post(`${API_BASE_URL}/api/v1/auth/refresh`, {}, {
    headers: { Authorization: `Bearer ${token}` }
  });
  
  localStorage.setItem('access_token', response.data.access_token);
  return response.data.access_token;
}
```

### 2. è®¤è¯ API å°è£…

```typescript
// lib/api/auth.ts
import { apiClient } from './client';

export interface LoginRequest {
  username: string;
  password: string;
}

export interface RegisterRequest {
  username: string;
  email?: string;
  password: string;
}

export interface AuthResponse {
  access_token: string;
  token_type: string;
  expires_in: number;
}

export interface User {
  id: number;
  username: string;
  email?: string;
  role: string;
  is_active: boolean;
  created_at: string;
  full_name?: string;
  avatar_url?: string;
  bio?: string;
  location?: string;
  website?: string;
}

// ç”¨æˆ·ç™»å½•
export async function login(data: LoginRequest): Promise<AuthResponse> {
  const formData = new FormData();
  formData.append('username', data.username);
  formData.append('password', data.password);
  
  const response = await apiClient.post('/api/v1/auth/login', formData, {
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
  });
  
  return response.data;
}

// ç”¨æˆ·æ³¨å†Œ
export async function register(data: RegisterRequest): Promise<User> {
  const response = await apiClient.post('/api/v1/auth/register', data);
  return response.data;
}

// åˆ·æ–°Token
export async function refreshToken(): Promise<AuthResponse> {
  const response = await apiClient.post('/api/v1/auth/refresh');
  return response.data;
}

// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
export async function getCurrentUser(): Promise<User> {
  const response = await apiClient.get('/api/v1/users/me');
  return response.data;
}

// æ›´æ–°ç”¨æˆ·èµ„æ–™
export async function updateProfile(data: Partial<User>): Promise<User> {
  const response = await apiClient.put('/api/v1/users/me', data);
  return response.data;
}

// è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
export async function getUserBasic(): Promise<User> {
  const response = await apiClient.get('/api/v1/users/me/basic');
  return response.data;
}

// è·å–æŒ‡å®šç”¨æˆ·å…¬å¼€èµ„æ–™
export async function getUserProfile(userId: number): Promise<User> {
  const response = await apiClient.get(`/api/v1/users/${userId}/profile`);
  return response.data;
}
```

### 3. è®¤è¯ Context å’Œ Hooks

```typescript
// lib/auth/context.tsx
'use client';
import React, { createContext, useContext, useEffect, useState } from 'react';
import { User } from '../api/auth';
import { getCurrentUser, login, register } from '../api/auth';

interface AuthContextType {
  user: User | null;
  loading: boolean;
  login: (username: string, password: string) => Promise<void>;
  register: (username: string, email: string, password: string) => Promise<void>;
  logout: () => void;
  refreshUser: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // åº”ç”¨å¯åŠ¨æ—¶æ£€æŸ¥Token
    checkAuth();
  }, []);

  async function checkAuth() {
    try {
      const token = localStorage.getItem('access_token');
      if (token) {
        const userData = await getCurrentUser();
        setUser(userData);
      }
    } catch (error) {
      localStorage.removeItem('access_token');
    } finally {
      setLoading(false);
    }
  }

  async function handleLogin(username: string, password: string) {
    try {
      const response = await login({ username, password });
      localStorage.setItem('access_token', response.access_token);
      
      const userData = await getCurrentUser();
      setUser(userData);
    } catch (error) {
      throw error;
    }
  }

  async function handleRegister(username: string, email: string, password: string) {
    try {
      await register({ username, email, password });
      // æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•
      await handleLogin(username, password);
    } catch (error) {
      throw error;
    }
  }

  function handleLogout() {
    localStorage.removeItem('access_token');
    setUser(null);
  }

  async function refreshUser() {
    try {
      const userData = await getCurrentUser();
      setUser(userData);
    } catch (error) {
      handleLogout();
    }
  }

  return (
    <AuthContext.Provider value={{
      user,
      loading,
      login: handleLogin,
      register: handleRegister,
      logout: handleLogout,
      refreshUser
    }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

### 4. è·¯ç”±ä¿æŠ¤ä¸­é—´ä»¶

```typescript
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // æ£€æŸ¥æ˜¯å¦æœ‰token
  const token = request.cookies.get('access_token')?.value;
  
  // å—ä¿æŠ¤çš„è·¯å¾„
  const protectedPaths = ['/dashboard', '/profile', '/settings'];
  const isProtectedPath = protectedPaths.some(path => 
    request.nextUrl.pathname.startsWith(path)
  );

  // è®¤è¯é¡µé¢è·¯å¾„
  const authPaths = ['/login', '/register'];
  const isAuthPath = authPaths.some(path => 
    request.nextUrl.pathname.startsWith(path)
  );

  // å¦‚æœè®¿é—®å—ä¿æŠ¤é¡µé¢ä½†æ²¡æœ‰tokenï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
  if (isProtectedPath && !token) {
    return NextResponse.redirect(new URL('/login', request.url));
  }

  // å¦‚æœå·²ç™»å½•ä½†è®¿é—®è®¤è¯é¡µé¢ï¼Œé‡å®šå‘åˆ°ä»ªè¡¨ç›˜
  if (isAuthPath && token) {
    return NextResponse.redirect(new URL('/dashboard', request.url));
  }

  return NextResponse.next();
}

export const config = {
  matcher: [
    '/dashboard/:path*',
    '/profile/:path*', 
    '/settings/:path*',
    '/login',
    '/register'
  ]
};
```

## ğŸ¨ ç»„ä»¶ç¤ºä¾‹

### 1. ç™»å½•è¡¨å•ç»„ä»¶

```typescript
// components/auth/LoginForm.tsx
'use client';
import { useState } from 'react';
import { useAuth } from '@/lib/auth/context';
import { useRouter } from 'next/navigation';

export default function LoginForm() {
  const [formData, setFormData] = useState({
    username: '',
    password: ''
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  
  const { login } = useAuth();
  const router = useRouter();

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      await login(formData.username, formData.password);
      router.push('/dashboard');
    } catch (err: any) {
      setError(err.response?.data?.detail || 'ç™»å½•å¤±è´¥');
    } finally {
      setLoading(false);
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <div>
        <label htmlFor="username" className="block text-sm font-medium">
          ç”¨æˆ·å
        </label>
        <input
          id="username"
          type="text"
          required
          value={formData.username}
          onChange={(e) => setFormData(prev => ({
            ...prev,
            username: e.target.value
          }))}
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
        />
      </div>

      <div>
        <label htmlFor="password" className="block text-sm font-medium">
          å¯†ç 
        </label>
        <input
          id="password"
          type="password"
          required
          value={formData.password}
          onChange={(e) => setFormData(prev => ({
            ...prev,
            password: e.target.value
          }))}
          className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
        />
      </div>

      {error && (
        <div className="text-red-600 text-sm">{error}</div>
      )}

      <button
        type="submit"
        disabled={loading}
        className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50"
      >
        {loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
      </button>
    </form>
  );
}
```

### 2. ç”¨æˆ·èµ„æ–™ç»„ä»¶

```typescript
// components/user/UserProfile.tsx
'use client';
import { useState, useEffect } from 'react';
import { useAuth } from '@/lib/auth/context';
import { updateProfile } from '@/lib/api/auth';

export default function UserProfile() {
  const { user, refreshUser } = useAuth();
  const [editing, setEditing] = useState(false);
  const [formData, setFormData] = useState({
    full_name: user?.full_name || '',
    bio: user?.bio || '',
    location: user?.location || '',
    website: user?.website || ''
  });
  const [loading, setLoading] = useState(false);

  async function handleSave() {
    setLoading(true);
    try {
      await updateProfile(formData);
      await refreshUser();
      setEditing(false);
    } catch (error) {
      console.error('æ›´æ–°å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  }

  if (!user) return <div>åŠ è½½ä¸­...</div>;

  return (
    <div className="bg-white shadow rounded-lg p-6">
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-xl font-bold">ä¸ªäººèµ„æ–™</h2>
        <button
          onClick={() => setEditing(!editing)}
          className="text-blue-600 hover:text-blue-800"
        >
          {editing ? 'å–æ¶ˆ' : 'ç¼–è¾‘'}
        </button>
      </div>

      <div className="space-y-4">
        <div>
          <label className="block text-sm font-medium text-gray-700">ç”¨æˆ·å</label>
          <p className="mt-1 text-sm text-gray-900">{user.username}</p>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700">é‚®ç®±</label>
          <p className="mt-1 text-sm text-gray-900">{user.email || 'æœªè®¾ç½®'}</p>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700">çœŸå®å§“å</label>
          {editing ? (
            <input
              type="text"
              value={formData.full_name}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                full_name: e.target.value
              }))}
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
            />
          ) : (
            <p className="mt-1 text-sm text-gray-900">{user.full_name || 'æœªè®¾ç½®'}</p>
          )}
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700">ä¸ªäººç®€ä»‹</label>
          {editing ? (
            <textarea
              value={formData.bio}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                bio: e.target.value
              }))}
              rows={3}
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"
            />
          ) : (
            <p className="mt-1 text-sm text-gray-900">{user.bio || 'æœªè®¾ç½®'}</p>
          )}
        </div>

        {editing && (
          <div className="flex space-x-3">
            <button
              onClick={handleSave}
              disabled={loading}
              className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50"
            >
              {loading ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
```

## ğŸ“¦ æ¨èæŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Next.js 14+** - Reactæ¡†æ¶ï¼ŒApp Router
- **TypeScript** - ç±»å‹å®‰å…¨
- **Tailwind CSS** - æ ·å¼æ¡†æ¶

### çŠ¶æ€ç®¡ç†
- **React Context** - ç”¨æˆ·è®¤è¯çŠ¶æ€
- **SWR æˆ– React Query** - æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†
- **Zustand** (å¯é€‰) - å¤æ‚æœ¬åœ°çŠ¶æ€

### UIç»„ä»¶åº“
- **Headless UI** - æ— æ ·å¼ç»„ä»¶
- **Radix UI** - é«˜è´¨é‡ç»„ä»¶
- **shadcn/ui** - ç°ä»£ç»„ä»¶åº“

### è¡¨å•å¤„ç†
- **React Hook Form** - è¡¨å•ç®¡ç†
- **Zod** - è¡¨å•éªŒè¯

### HTTPå®¢æˆ·ç«¯
- **Axios** - HTTPè¯·æ±‚åº“
- **SWR** - æ•°æ®è·å–å’Œç¼“å­˜

## ğŸš€ å¼€å‘æµç¨‹å»ºè®®

### 1. é¡¹ç›®åˆå§‹åŒ–
```bash
# åˆ›å»ºNext.jsé¡¹ç›®
npx create-next-app@latest peerpotal-frontend --typescript --tailwind --app

# å®‰è£…å¿…è¦ä¾èµ–
npm install axios swr react-hook-form @hookform/resolvers zod
```

### 2. å¼€å‘é¡ºåº
1. **è®¾ç½®APIå®¢æˆ·ç«¯** - é…ç½®axioså’Œæ‹¦æˆªå™¨
2. **å®ç°è®¤è¯ç³»ç»Ÿ** - Contextã€hooksã€APIè°ƒç”¨
3. **åˆ›å»ºåŸºç¡€å¸ƒå±€** - å¯¼èˆªæ ã€ä¾§è¾¹æ ã€footer
4. **å¼€å‘è®¤è¯é¡µé¢** - ç™»å½•ã€æ³¨å†Œè¡¨å•
5. **å®ç°ç”¨æˆ·åŠŸèƒ½** - ä¸ªäººèµ„æ–™ã€è®¾ç½®é¡µé¢
6. **æ·»åŠ è·¯ç”±ä¿æŠ¤** - ä¸­é—´ä»¶å’Œæƒé™æ§åˆ¶
7. **å®Œå–„é”™è¯¯å¤„ç†** - å…¨å±€é”™è¯¯è¾¹ç•Œå’Œæç¤º

### 3. æµ‹è¯•å»ºè®®
```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
npm install -D @testing-library/react @testing-library/jest-dom jest jest-environment-jsdom

# è¿è¡Œæµ‹è¯•
npm run test
```

## ğŸ”— é‡è¦é“¾æ¥

- **åç«¯APIæ–‡æ¡£**: http://localhost:8001/docs
- **åç«¯å¥åº·æ£€æŸ¥**: http://localhost:8001/health
- **æµ‹è¯•ç”¨æˆ·**: username: `frederick`, password: `123456`

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Tokenç®¡ç†**: JWT Tokenæœ‰æ•ˆæœŸ60åˆ†é’Ÿï¼Œéœ€è¦å¤„ç†è‡ªåŠ¨åˆ·æ–°
2. **é”™è¯¯å¤„ç†**: åç«¯è¿”å›ä¸­æ–‡é”™è¯¯ä¿¡æ¯ï¼Œå¯ç›´æ¥å±•ç¤ºç»™ç”¨æˆ·
3. **CORS**: åç«¯å·²é…ç½®CORSï¼Œæ”¯æŒlocalhost:3000
4. **ç±»å‹å®šä¹‰**: ä¸¥æ ¼æŒ‰ç…§åç«¯APIå“åº”ç»“æ„å®šä¹‰TypeScriptç±»å‹
5. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨SWRç¼“å­˜ç”¨æˆ·æ•°æ®ï¼Œå‡å°‘é‡å¤è¯·æ±‚

---

ğŸ‰ **åç«¯APIå·²100%å°±ç»ªï¼Œå‰ç«¯å¯ä»¥å®‰å¿ƒå¼€å‘ï¼**

